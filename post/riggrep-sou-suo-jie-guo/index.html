<html>
  <head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>riggrep 搜索结果 | Gridea</title>
<link rel="shortcut icon" href="http://xuwanjin.me//favicon.ico?v=1560355067735">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="http://xuwanjin.me//styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>



  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="http://xuwanjin.me/">
  <img class="avatar" src="http://xuwanjin.me//images/avatar.png?v=1560355067735" alt="">
  </a>
  <h1 class="site-title">
    Gridea
  </h1>
  <p class="site-description">
    温故而知新
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>


        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              riggrep 搜索结果
            </h2>
            <div class="post-info">
              <time class="post-time">
                · 2019-06-12 ·
              </time>
              
                <a href="http://xuwanjin.me//tag/AeyrTrOwL" class="post-tag">
                  # rust
                </a>
              
                <a href="http://xuwanjin.me//tag/a6BL0o3oo" class="post-tag">
                  # ripgrep
                </a>
              
            </div>
            
            <div class="post-content">
              <p>经常使用 ripgrep 来在 aosp 代码库里搜索代码, 已经不在使用 grep, grep 效率低下. 偶尔也会替换时掉 mangrep, jgrep, cgrep, mgrep感觉到了 riggrep 的确很强大, 速度很快.</p>
<!-- more -->
<h1 id="riggrep-搜索结果">riggrep 搜索结果</h1>
<h2 id="问题">问题</h2>
<p>最近发现riggrep，执行搜索命令的时候出现了结果不对的情况</p>
<h2 id="思考">思考</h2>
<p>于是觉得这是一个bug， 只是很奇怪，rust 遍历系统当前的文件，然后唯独失去了<code>common</code>文件夹的搜索, 这事为什么呢?
当我 cd 到这个目录再执行的时候，他却能搜的出来结果, 很奇怪。</p>
<h2 id="解决过程">解决过程</h2>
<h3 id="查看源码">查看源码</h3>
<p>这个时候第一想法，是看看源代码，源码是怎么写的。这可能和我的一直做 Android Framework 的工作原因, 第一个想到的事情就是阅读源码.
找了好久才找到了 ripgrep 的程序入口 <code>ripgrep/src/main.rs</code></p>
<pre><code class="language-rust">fn main() {
//这里是对命令行参数的解析
    match Args::parse().and_then(try_main) {
        Ok(true) =&gt; process::exit(0),
        Ok(false) =&gt; process::exit(1),
        Err(err) =&gt; {
            eprintln!(&quot;{}&quot;, err);
            process::exit(2);
        }
    }
}
</code></pre>
<pre><code class="language-rust">fn try_main(args: Args) -&gt; Result&lt;bool&gt; {
    use args::Command::*;

    match args.command()? {
        Search =&gt; search(args), //单线程搜索， 我主要看这里
        SearchParallel =&gt; search_parallel(args), //多线程搜索的
        SearchNever =&gt; Ok(false),
        Files =&gt; files(args),
        FilesParallel =&gt; files_parallel(args),
        Types =&gt; types(args),
    }
}
</code></pre>
<pre><code class="language-rust">/// The top-level entry point for single-threaded search. This recursively
/// steps through the file list (current directory by default) and searches
/// each file sequentially.
fn search(args: Args) -&gt; Result&lt;bool&gt; {
    let started_at = Instant::now();
    let quit_after_match = args.quit_after_match()?;
    let subject_builder = args.subject_builder();
    let mut stats = args.stats()?;
    let mut searcher = args.search_worker(args.stdout())?;
    let mut matched = false;

    for result in args.walker()? { //应该是这个地方开始遍历文件的，我想在这里对所有的路径加个log
        let subject = match subject_builder.build_from_result(result) {
            Some(subject) =&gt; subject,
            None =&gt; continue,
        };
        let search_result = match searcher.search(&amp;subject) {
            Ok(search_result) =&gt; search_result,
            Err(err) =&gt; {
                // A broken pipe means graceful termination.
                if err.kind() == io::ErrorKind::BrokenPipe {
                    break;
                }
                message!(&quot;{}: {}&quot;, subject.path().display(), err);
                continue;
            }
        };
        matched = matched || search_result.has_match();
        if let Some(ref mut stats) = stats {
            *stats += search_result.stats().unwrap();
        }
        if matched &amp;&amp; quit_after_match {
            break;
        }
    }
    if let Some(ref stats) = stats {
        let elapsed = Instant::now().duration_since(started_at);
        // We don't care if we couldn't print this successfully.
        let _ = searcher.print_stats(elapsed, stats);
    }
    Ok(matched)
}

</code></pre>
<p>于是我想在遍历路径的地方，加一个log， 想知道为什么他就没有搜索<code>common</code>路径。
在各种百度和google的情况下。还是不知到rust语言是如何加log。但是我看到了源码里有一个<code>logger</code>模块.
在代码里发现这样的code</p>
<pre><code class="language-rust">fn enabled(&amp;self, _: &amp;log::Metadata) -&gt; bool {
    // We set the log level via log::set_max_level, so we don't need to
    // implement filtering here.
    true
}
</code></pre>
<p>于是我全局搜了一下<code>set_max_level</code>这个</p>
<pre><code class="language-rust">/// Parse the command line arguments for this process.
///
/// If a CLI usage error occurred, then exit the process and print a usage
/// or error message. Similarly, if the user requested the version of
/// ripgrep, then print the version and exit.
///
/// Also, initialize a global logger.
pub fn parse() -&gt; Result&lt;Args&gt; {
    // We parse the args given on CLI. This does not include args from
    // the config. We use the CLI args as an initial configuration while
    // trying to parse config files. If a config file exists and has
    // arguments, then we re-parse argv, otherwise we just use the matches
    // we have here.
    let early_matches = ArgMatches::new(app::app().get_matches());
    set_messages(!early_matches.is_present(&quot;no-messages&quot;));
    set_ignore_messages(!early_matches.is_present(&quot;no-ignore-messages&quot;));
	
    if let Err(err) = Logger::init() {
        return Err(format!(&quot;failed to initialize logger: {}&quot;, err).into());
    }
    if early_matches.is_present(&quot;trace&quot;) {
        log::set_max_level(log::LevelFilter::Trace);
    } else if early_matches.is_present(&quot;debug&quot;) {
        log::set_max_level(log::LevelFilter::Debug);
    } else {
        log::set_max_level(log::LevelFilter::Warn);
    }

    let matches = early_matches.reconfigure();
    // The logging level may have changed if we brought in additional
    // arguments from a configuration file, so recheck it and set the log
    // level as appropriate.
    if matches.is_present(&quot;trace&quot;) {
        log::set_max_level(log::LevelFilter::Trace);
    } else if matches.is_present(&quot;debug&quot;) {
        log::set_max_level(log::LevelFilter::Debug);
    } else {
        log::set_max_level(log::LevelFilter::Warn);
    }
    set_messages(!matches.is_present(&quot;no-messages&quot;));
    set_ignore_messages(!matches.is_present(&quot;no-ignore-messages&quot;));
    matches.to_args()
}

</code></pre>
<p>从代码里来看<code>rg</code>命令似乎有debug和trace参数。
于是我<code>help</code>了一下这个命令</p>
<pre><code>--debug                             
		Show debug messages. Please use this when filing a bug report.
		
		The --debug flag is generally useful for figuring out why ripgrep skipped
		searching a particular file. The debug messages should mention all files
		skipped and why they were skipped.
		
		To get even more debug output, use the --trace flag, which implies --debug
		along with additional trace data. With --trace, the output could be quite
		large and is generally more useful for development.

</code></pre>
<p>于是接下来使用了这个命令
使用rg命令默认的输出log的命令搜索改</p>
<pre><code>rg config_screenBrightnessDoze -c --trace 2&gt;&amp;1 | tee result.log
</code></pre>
<h3 id="查看log">查看log</h3>
<p>搜索出的结果是这样的</p>
<pre><code>DEBUG|grep_regex::literal|grep-regex/src/literal.rs:58: literal prefixes detected: Literals { lits: [Complete(config_screenBrightnessDoze)], limit_size: 250, limit_class: 10 }
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 3 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;vold.fstab&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
DEBUG|ignore::walk|ignore/src/walk.rs:1611: ignoring ./.git: Ignore(IgnoreMatch(Hidden))
DEBUG|ignore::walk|ignore/src/walk.rs:1611: ignoring ./opensource: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(&quot;./.gitignore&quot;), original: &quot;opensource&quot;, actual: &quot;**/opensource&quot;, is_whitelist: false, is_only_dir: false })))
DEBUG|ignore::walk|ignore/src/walk.rs:1611: ignoring ./.gitignore: Ignore(IgnoreMatch(Hidden))
DEBUG|ignore::walk|ignore/src/walk.rs:1611: ignoring ./common: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(&quot;./.gitignore&quot;), original: &quot;common&quot;, actual: &quot;**/common&quot;, is_whitelist: false, is_only_dir: false })))
DEBUG|ignore::walk|ignore/src/walk.rs:1611: ignoring ./sepolicy: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(&quot;./.gitignore&quot;), original: &quot;sepolicy&quot;, actual: &quot;**/sepolicy&quot;, is_whitelist: false, is_only_dir: false })))
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;AndroidBoard.mk&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;pixart_pat9125.idc&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;hostapd.conf&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;mixer_paths_skuc.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 1 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|ignore::walk|ignore/src/walk.rs:1611: ignoring ./cdrom_res/.gitignore: Ignore(IgnoreMatch(Hidden))
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;ft5x06_ts.kl&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;sound_trigger_platform_info.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;init.qti.synaptics_dsx_qhd.sh&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;mixer_paths_qrd_skuh.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;init.target.rc&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;msm8909w.mk&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;android_filesystem_config.h&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;mixer_paths_qrd_skut.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;mixer_paths_skue.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;system.prop&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;egl.cfg&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;synaptics_dsx.kl&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;recovery.fstab&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;mixer_paths_skua.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;WCNSS_qcom_cfg.ini&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;wpa_supplicant_overlay.conf&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;mixer_paths_qrd_skui.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;Android.mk&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;recovery_nand.fstab&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;gpio-keys.kl&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;mixer_paths.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;BoardConfig.mk&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;init.qcom.modem_links.sh&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;wpa_supplicant.conf&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;result.log&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;listen_platform_info.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;mixer_paths_msm8909_pm8916.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;WCNSS_qcom_wlan_nv.bin&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;audio_effects.conf&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;AndroidProducts.mk&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;synaptics_rmi4_i2c.kl&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;hostapd.deny&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;sound_trigger_mixer_paths.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;wearable_core_hardware.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;hostapd.accept&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;fstab.qcom&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;init.carrier.rc&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;atmel_mxt_ts.kl&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;audio_policy.conf&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;WCNSS_wlan_dictionary.dat&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;p2p_supplicant_overlay.conf&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;radio/filesmap&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;cdrom_res/README.txt&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;media/media_codecs_8909.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;media/media_profiles_8909.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;seccomp/mediaextractor-seccomp.policy&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;snd_soc_msm/snd_soc_msm_Taiko_Fluid&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;seccomp/mediacodec-seccomp.policy&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;snd_soc_msm/snd_soc_msm_Taiko_CDP&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;snd_soc_msm/snd_soc_msm_Taiko_liquid&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;snd_soc_msm/snd_soc_msm_Taiko&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;sensors/hals.conf&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;overlay/packages/apps/Settings/res/values/styles.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;overlay/packages/apps/Settings/res/values/bools.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;overlay/packages/apps/Dialer/InCallUI/res/values/styles.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;overlay/frameworks/base/core/res/res/values-watch/themes_material.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;overlay/packages/apps/Dialer/InCallUI/res/values/colors.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;overlay/frameworks/base/core/res/res/xml/power_profile.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;product/overlay/frameworks/base/core/res/res/values/config.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: product/overlay/frameworks/base/core/res/res/values/config.xml:1
Some(&quot;overlay/frameworks/base/core/res/res/layout-watch/alert_dialog_material.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;overlay/frameworks/base/core/res/res/values/config.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;overlay/frameworks/base/core/res/res/values/themes.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;overlay/frameworks/base/core/res/res/values/themes_material.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;overlay/frameworks/base/core/res/res/values/styles.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:639: Some(&quot;overlay/frameworks/base/packages/SystemUI/res/values/config.xml&quot;): searching using generic reader
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
result.log:1
</code></pre>
<h3 id="分析log">分析log</h3>
<p>上面是搜索的trace文件，在trace文件里我们可以看到。有一个文件</p>
<pre><code>product/overlay/frameworks/base/core/res/res/values/config.xml
</code></pre>
<p>是执行了搜索的操作的。
从再看一下这个搜索的trace文件开始的地方</p>
<pre><code>DEBUG|ignore::walk|ignore/src/walk.rs:1611: ignoring ./.git: Ignore(IgnoreMatch(Hidden))
DEBUG|ignore::walk|ignore/src/walk.rs:1611: ignoring ./opensource: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(&quot;./.gitignore&quot;), original: &quot;opensource&quot;, actual: &quot;**/opensource&quot;, is_whitelist: false, is_only_dir: false })))
DEBUG|ignore::walk|ignore/src/walk.rs:1611: ignoring ./.gitignore: Ignore(IgnoreMatch(Hidden))
DEBUG|ignore::walk|ignore/src/walk.rs:1611: ignoring ./common: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(&quot;./.gitignore&quot;), original: &quot;common&quot;, actual: &quot;**/common&quot;, is_whitelist: false, is_only_dir: false })))
DEBUG|ignore::walk|ignore/src/walk.rs:1611: ignoring ./sepolicy: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(&quot;./.gitignore&quot;), original: &quot;sepolicy&quot;, actual: &quot;**/sepolicy&quot;, is_whitelist: false, is_only_dir: false })))
</code></pre>
<p>很明显在搜索他忽略了<code>common</code>, <code>sepolicy</code>, <code>opensource</code>三个目录，
从log的意思来看，他是从<code>.gitignore</code>里忽略了这三个目录。
我打开这个文件的的<code>.gitignore</code>文件，发现了他的确忽略了这三个目录。</p>
<h3 id="验证之前的想法">验证之前的想法</h3>
<pre><code>ubuntu14@ubuntu14:msm8909w$ cat .gitignore 
sepolicy
common
opensource
</code></pre>
<p>于是我把这个文件的文件内容删除掉.
再次搜索，</p>
<pre><code>ubuntu14@ubuntu14:msm8909w$ rg config_screenBrightnessDoze 
product/overlay/frameworks/base/core/res/res/values/config.xml
38:    &lt;integer name=&quot;config_screenBrightnessDoze&quot;&gt;17&lt;/integer&gt;
common/product/overlay/frameworks/base/core/res/res/values/config.xml
45:    &lt;integer name=&quot;config_screenBrightnessDoze&quot;&gt;17&lt;/integer&gt;
</code></pre>
<p>果然，出现了搜索出了<code>common</code>目录下的文件。
如果使用<code>--no-ignore</code>参数搜索也可以有。</p>
<pre><code>ubuntu14@ubuntu14:msm8909w$ rg config_screenBrightnessDoze  --no-ignore
product/overlay/frameworks/base/core/res/res/values/config.xml
38:    &lt;integer name=&quot;config_screenBrightnessDoze&quot;&gt;17&lt;/integer&gt;

common/product/overlay/frameworks/base/core/res/res/values/config.xml
45:    &lt;integer name=&quot;config_screenBrightnessDoze&quot;&gt;17&lt;/integer&gt;
</code></pre>
<h2 id="总结">总结</h2>
<p>原来 rg 搜索， 默认会忽略掉<code>.gitignore</code>文件里的忽略的文件。 也就是说，对一个git仓库，ripgrep 会默认不搜索不在版本控制的文件。</p>

            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="http://xuwanjin.me//post/android-wear-ota-sheng-ji">
              <h3 class="post-title">
                Android Wear OTA 升级
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="http://xuwanjin.me//atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

      </div>
    </div>
  </body>
</html>
